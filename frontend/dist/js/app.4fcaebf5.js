(function(){"use strict";var e={5730:function(e,t,o){var r=o(6848),s=function(){var e=this,t=e._self._c;return t("router-view")},a=[],i={name:"App"},n=i,l=o(1656),d=(0,l.A)(n,s,a,!1,null,null,null),c=d.exports,m=(o(8111),o(3579),o(6178)),u=o(3518);r["default"].use(u.Ay);var p=new u.Ay.Store({state:{token:localStorage.getItem("token")||"",modelOptions:""},mutations:{setToken(e,t){e.token=t,localStorage.setItem("token",t)},clearToken(e){e.token="",localStorage.removeItem("token")}},actions:{login({commit:e},t){e("setToken",t)},logout({commit:e}){e("clearToken")}}}),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"global-container"},[t("div",{staticClass:"auth-container"},[t("h2",[e._v("登录")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("label",{attrs:{for:"login-username"}},[e._v("用户名:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.username,expression:"form.username"}],attrs:{type:"text",id:"login-username",required:""},domProps:{value:e.form.username},on:{input:function(t){t.target.composing||e.$set(e.form,"username",t.target.value)}}}),t("label",{attrs:{for:"login-password"}},[e._v("密码:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password,expression:"form.password"}],attrs:{type:"password",id:"login-password",required:""},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value)}}}),t("button",{attrs:{type:"submit"}},[e._v("登录")])]),t("p",[e._v("还没有账号？ "),t("router-link",{attrs:{to:"/register"}},[e._v("注册")])],1)])])},f=[],v=(o(4114),o(4373)),g={data(){return{form:{username:"",password:""}}},methods:{async handleSubmit(){try{const e=await v.A.post("/api/auth/login",{username:this.form.username,password:this.form.password},{headers:{"Content-Type":"application/json"}});1===e.data.code?(this.$message.success("登录成功"),localStorage.setItem("token",e.data.data),this.$store.state.token=e.data.data,setTimeout((()=>{this.$router.push("/home")}),1e3)):this.$message.error(e.data.msg)}catch(e){this.$message.error("登录失败，请检查网络设置")}}}},b=g,w=(0,l.A)(b,h,f,!1,null,"4724d21f",null),y=w.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"global-container"},[t("div",{staticClass:"auth-container register-container"},[t("h2",[e._v("注册")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("label",{attrs:{for:"reg-username"}},[e._v("用户名:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.username,expression:"form.username"}],attrs:{type:"text",id:"reg-username",required:""},domProps:{value:e.form.username},on:{input:function(t){t.target.composing||e.$set(e.form,"username",t.target.value)}}}),t("label",{attrs:{for:"reg-email"}},[e._v("邮箱:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.email,expression:"form.email"}],attrs:{type:"email",id:"reg-email",required:""},domProps:{value:e.form.email},on:{input:function(t){t.target.composing||e.$set(e.form,"email",t.target.value)}}}),t("label",{attrs:{for:"reg-password"}},[e._v("密码:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password,expression:"form.password"}],attrs:{type:"password",id:"reg-password",required:""},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value)}}}),t("button",{attrs:{type:"submit"}},[e._v("注册")])]),t("p",[e._v("已有账号？ "),t("router-link",{attrs:{to:"/login"}},[e._v("登录")])],1)])])},C=[],x={data(){return{form:{username:"",email:"",password:""}}},methods:{async handleSubmit(){try{const e=await v.A.post("/api/auth/register",{username:this.form.username,email:this.form.email,password:this.form.password},{headers:{"Content-Type":"application/json"}});1===e.data.code?(this.$message.success("注册成功，请登录！"),setTimeout((()=>{this.$router.push("/login")}),1e3)):this.$message.error(e.data.msg)}catch(e){this.$message.error("注册失败")}}}},$=x,k=(0,l.A)($,_,C,!1,null,"7ba6880c",null),O=k.exports,P=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home-container"},[t("el-menu",{staticClass:"sidebar",attrs:{"default-active":e.activeIndex,collapse:e.isCollapse,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.handleSelect}},[t("el-menu-item",{attrs:{index:"1"}},[t("i",{staticClass:"el-icon-edit"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("LaTex优化")])]),t("el-menu-item",{attrs:{index:"2"}},[t("i",{staticClass:"el-icon-s-operation"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("用户信息")])]),t("el-menu-item",{attrs:{index:"3"}},[t("i",{staticClass:"el-icon-switch-button"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("退出")])])],1),t("div",{staticClass:"main-content"},[t("div",{staticClass:"content-wrapper"},[t(e.currentComponent,{tag:"component"})],1)])],1)},I=[],T=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("el-row",{staticClass:"wrapper",attrs:{gutter:40,type:"flex",justify:"center"}},[t("el-col",{staticClass:"section-group",attrs:{span:10}},[t("el-card",{staticClass:"section-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("用户输入")]),t("el-input",{staticClass:"input-area",attrs:{type:"textarea",autosize:{minRows:10},placeholder:"输入LaTeX公式"},model:{value:e.userInput,callback:function(t){e.userInput=t},expression:"userInput"}})],1),t("el-card",{staticClass:"section-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("实时渲染（输入）")]),t("div",{staticClass:"render-area",domProps:{innerHTML:e._s(e.inputPreview)}})])],1),t("el-col",{staticClass:"button-col",attrs:{span:2}},[t("el-select",{staticClass:"model-select",attrs:{placeholder:"选择模型",disabled:0===e.modelOptions.length},model:{value:e.selectedModel,callback:function(t){e.selectedModel=t},expression:"selectedModel"}},e._l(e.modelOptions,(function(e){return t("el-option",{key:e.modelId,attrs:{label:`${e.modelName} (${e.provider})`,value:e.modelId}})})),1),t("el-button",{staticClass:"optimize-btn",attrs:{type:"primary",loading:e.loading},on:{click:e.handleOptimize}},[t("span",{staticClass:"btn-text"},[e._v("AI优化")])])],1),t("el-col",{staticClass:"section-group",attrs:{span:10}},[t("el-card",{staticClass:"section-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("优化结果")]),t("pre",{staticClass:"result-code"},[e._v(e._s(e.optimizedCode))])]),t("el-card",{staticClass:"section-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("实时渲染（结果）")]),t("div",{staticClass:"render-area",domProps:{innerHTML:e._s(e.resultPreview)}})])],1)],1)],1)},S=[],A=o(437),M={data(){return{userInput:"",optimizedCode:"",loading:!1,renderError:null,selectedModel:""}},computed:{inputPreview(){return this.renderLatex(this.userInput)},resultPreview(){return this.renderLatex(this.optimizedCode)},modelOptions(){return this.$store.state.modelOptions||[]}},methods:{renderLatex(e){try{return A.Ay.renderToString(e,{throwOnError:!0,displayMode:!0})}catch(t){return`<div class="error">渲染错误: ${t.message}</div>`}},async handleOptimize(){if(this.userInput.trim())if(""!==this.selectedModel){this.loading=!0;try{const e=await v.A.post("/api/model/optimize",{latex:this.userInput,modelId:this.selectedModel});this.optimizedCode=e.data.data,this.$message.success("优化成功")}catch(e){this.$message.error(`优化失败: ${e.message}`),console.error("API Error:",e)}finally{this.loading=!1}}else this.$message.warning("请选择模型");else this.$message.warning("请输入内容")}}},N=M,j=(0,l.A)(N,T,S,!1,null,"35867f6b",null),q=j.exports,z=function(){var e=this,t=e._self._c;return t("div",[e.loading?t("div",{staticClass:"loading-container"},[e._v("加载中...")]):t("div",[t("el-card",{staticClass:"user-card"},[t("el-descriptions",{attrs:{title:"用户信息",border:""}},[t("el-descriptions-item",{attrs:{label:"用户名"}},[e._v(e._s(e.userInfo.username))]),t("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(e._s(e.userInfo.email))])],1)],1),t("div",{staticClass:"action-container"},[t("el-button",{attrs:{type:"primary"},on:{click:e.openModelDialog}},[e._v("添加模型")])],1),t("el-dialog",{attrs:{title:"添加模型",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"modelForm",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"模型名称",prop:"modelName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请先选择模型",filterable:"",clearable:""},on:{change:e.handleModelChange},model:{value:e.form.modelName,callback:function(t){e.$set(e.form,"modelName",t)},expression:"form.modelName"}},e._l(Object.keys(e.modelToProviders),(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"供应商",prop:"provider"}},[t("div",{staticClass:"select-wrapper",on:{click:e.handleProviderClick}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请先选择模型",disabled:!e.form.modelName,filterable:"",clearable:""},model:{value:e.form.provider,callback:function(t){e.$set(e.form,"provider",t)},expression:"form.provider"}},e._l(e.availableProviders,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1),e.showProviderTip?t("div",{staticClass:"select-tip"},[e._v(" 请先选择模型名称 ")]):e._e()],1)]),t("el-form-item",{attrs:{label:"API Key",prop:"apiKey"}},[t("el-input",{attrs:{"show-password":"",placeholder:"请输入API密钥",clearable:""},model:{value:e.form.apiKey,callback:function(t){e.$set(e.form,"apiKey",t)},expression:"form.apiKey"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitModel}},[e._v("提交")])],1)],1),t("el-card",{staticClass:"quota-card"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.quotas}},[t("el-table-column",{attrs:{prop:"modelName",label:"模型名称",width:"180"}}),t("el-table-column",{attrs:{prop:"provider",label:"供应商"}}),t("el-table-column",{attrs:{label:"总配额",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.totalQuota)+" tokens ")]}}])}),t("el-table-column",{attrs:{label:"已用配额",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.usedQuota)+" tokens ")]}}])}),t("el-table-column",{attrs:{label:"使用进度",width:"200"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-progress",{attrs:{percentage:parseFloat((o.row.usedQuota/o.row.totalQuota*100).toFixed(1)),color:e.customColors,format:e.progressFormat}})]}}])})],1)],1)],1)])},L=[],F=(o(7588),o(1701),o(7642),o(8004),o(3853),o(5876),o(2475),o(5024),o(1698),{data(){return{loading:!1,userInfo:{username:"",email:""},quotas:[],dialogVisible:!1,modelOptions:[],form:{modelName:"",provider:"",apiKey:""},customColors:[{color:"#f56c6c",percentage:80},{color:"#e6a23c",percentage:60},{color:"#5cb87a",percentage:40}],rules:{modelName:[{required:!0,message:"请选择模型名称",trigger:"change"}],provider:[{required:!0,message:"请选择供应商",trigger:"change"}],apiKey:[{required:!0,message:"请输入API密钥",trigger:"blur"},{min:8,message:"API密钥长度至少8位",trigger:"blur"}]},modelToProviders:{},availableProviders:[],showProviderTip:!1}},created(){this.fetchUserInfo()},methods:{async fetchUserInfo(){try{this.loading=!0;const e=await this.$axios.get("/api/user/info");1===e.data.code?(this.userInfo={username:e.data.data.username,email:e.data.data.email},this.quotas=e.data.data.quotas):this.$message.error(e.data.msg||"获取用户信息失败")}catch(e){console.error("请求失败:",e),this.$message.error("获取用户信息失败，请稍后重试")}finally{this.loading=!1}},async openModelDialog(){try{const e=await this.$axios.get("/api/model/info");1===e.data.code?(this.modelOptions=e.data.data,this.buildMappings(),this.dialogVisible=!0,this.$store.state.modelOptions=this.modelOptions):this.$message.error(e.data.msg||"获取模型列表失败")}catch(e){console.error("请求失败:",e),this.$message.error("获取模型列表失败"),this.dialogVisible=!1}},buildMappings(){const e={};this.modelOptions.forEach((t=>{e[t.modelName]||(e[t.modelName]=new Set),e[t.modelName].add(t.provider)})),this.modelToProviders=Object.fromEntries(Object.entries(e).map((([e,t])=>[e,Array.from(t)])))},handleModelChange(e){this.form.provider="",this.availableProviders=this.modelToProviders[e]||[],this.showProviderTip=!1},handleProviderClick(){this.form.modelName||(this.showProviderTip=!0,setTimeout((()=>{this.showProviderTip=!1}),2e3))},validateCombination(){return this.modelOptions.some((e=>e.modelName===this.form.modelName&&e.provider===this.form.provider))},submitModel(){this.$refs.modelForm.validate((e=>{e&&this.validateCombination()?this.$axios.post("/api/model/add",this.form,{headers:{"Content-Type":"application/json"}}).then((e=>{console.log("提交数据:",this.form),this.$message.success("模型添加成功"),this.fetchUserInfo(),this.dialogVisible=!1,this.resetForm()})).catch((e=>{console.error("提交失败:",e),this.$message.error("模型添加失败")})):this.$message.error("请选择有效的模型与供应商组合")}))},resetForm(){this.form={modelName:"",provider:"",apiKey:""},this.availableProviders=[],this.$nextTick((()=>{this.$refs.modelForm.clearValidate()}))},progressFormat(e){return`${e}%`}}}),E=F,K=(0,l.A)(E,z,L,!1,null,"c067f90c",null),V=K.exports,D={name:"Home",components:{LatexOptimize:q,UserManage:V},data(){return{activeIndex:"1",isCollapse:!1,currentComponent:"LatexOptimize"}},methods:{handleSelect(e){"1"===e?this.currentComponent="LatexOptimize":"2"===e?this.currentComponent="UserManage":"3"===e&&this.$confirm("确定要退出系统吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$store.state.token="",localStorage.removeItem("token"),this.$router.push("/login")}))},async openModelDialog(){try{const e=await this.$axios.get("/api/user/used");1===e.data.code?(this.modelOptions=e.data.data,this.$store.state.modelOptions=this.modelOptions,console.log(this.modelOptions)):this.$message.error(e.data.msg||"获取模型列表失败")}catch(e){console.error("请求失败:",e),this.$message.error("获取模型列表失败")}}},mounted(){const e=()=>{this.isCollapse=window.innerWidth<768};window.addEventListener("resize",e),e(),this.openModelDialog()}},U=D,H=(0,l.A)(U,P,I,!1,null,"07918bd2",null),Q=H.exports;r["default"].use(m.Ay);const B=new m.Ay({mode:"history",routes:[{path:"/",redirect:()=>localStorage.getItem("token")?"/home":"/login"},{path:"/login",name:"Login",component:y},{path:"/register",name:"Register",component:O},{path:"/home",name:"Home",component:Q,meta:{requiresAuth:!0}}]});B.beforeEach(((e,t,o)=>{e.matched.some((e=>e.meta.requiresAuth))?localStorage.getItem("token")?o():o({name:"Login"}):o()}));var R=B,W=o(9143),X=o.n(W);r["default"].use(X()),v.A.interceptors.request.use((function(e){const t=localStorage.getItem("token");return console.log(t),t&&(e.headers.Authorization=t),e}),(e=>Promise.reject(e))),r["default"].prototype.$axios=v.A,r["default"].config.productionTip=!1,new r["default"]({router:R,store:p,render:e=>e(c)}).$mount("#app")}},t={};function o(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=e,function(){o.amdO={}}(),function(){var e=[];o.O=function(t,r,s,a){if(!r){var i=1/0;for(c=0;c<e.length;c++){r=e[c][0],s=e[c][1],a=e[c][2];for(var n=!0,l=0;l<r.length;l++)(!1&a||i>=a)&&Object.keys(o.O).every((function(e){return o.O[e](r[l])}))?r.splice(l--,1):(n=!1,a<i&&(i=a));if(n){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,s,a]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,r){var s,a,i=r[0],n=r[1],l=r[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(s in n)o.o(n,s)&&(o.m[s]=n[s]);if(l)var c=l(o)}for(t&&t(r);d<i.length;d++)a=i[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},r=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=o.O(void 0,[504],(function(){return o(5730)}));r=o.O(r)})();
//# sourceMappingURL=app.4fcaebf5.js.map